@model ChooseInvoiceForCreditNoteViewModel
@using SSMO.Services.Products
@using SSMO.Services.MyCompany
@inject IProductService service;
@inject IMycompanyService mycompanyService;
 <script type="text/javascript" src="~/js/datepicker.js">   
    </script>
 
<p class="font-weight-bold">Choose Invoice for Credit Note</p>
<form method="post">
    <div class="container">
        <div class="row col-md-4 mb-3">
            <label asp-for="MyCompanyId">Seller</label>
            <select name= "MyCompanyId" asp-for="MyCompanyId" class="form-control">
            <option value="">All</option>
                @foreach (var myCompany in Model.MyCompanies)
                {
                   <option value="@myCompany.Id">@myCompany.Name</option>
                }

            </select>
        </div>
         <div class="row col-md-4 mb-3">           
             <label asp-for="InvoiceId" class="control-label"> Select Invoice</label>
             <select class="form-control" id="InvoiceNumber" name="InvoiceId" asp-for="InvoiceId" asp-items="@(new SelectList(string.Empty,"InvoiceId", "InvoiceNumber"))"></select>               
        </div>    
        <div class="row col-md-4" id="datepicker">
            <label asp-for="Date" >Date Credit note</label>
            <input itemid="date" asp-for="Date" name="Date" type="date" value="@DateTime.Now.ToString("dd-MM-yyyy")" id="datepicker" class="form-control"/> 
            <span asp-validation-for="Date" class="small text-danger"></span>
        </div>

         <div class="row col-md-4">
            <label asp-for="CreditNoteDeliveryAddress" >Delivery Address</label>
            <input asp-for="CreditNoteDeliveryAddress" type="text" class="form-control"/> 
            <span asp-validation-for="CreditNoteDeliveryAddress" class="small text-danger"></span>
        </div>
         <div class="row col-md-4">
            <label asp-for="LoadingAddress" >Loading Address</label>
            <input asp-for="LoadingAddress" type="text" class="form-control"/> 
            <span asp-validation-for="LoadingAddress" class="small text-danger"></span>
        </div>
        <div class="row col-md-4">
           <label asp-for="PaymentTerms">Payment Terms</label>
           <input asp-for="PaymentTerms" type="text" class="form-control"/>
       </div>
        <div class="row col-md-4">         
         <input id="quantityBack" class="form-check-input" type="checkbox" asp-for="QuantityBack" name="quantityBack">
         <label asp-for="QuantityBack">Quantity back</label>
        </div>
        <hr />

        <div  class="table-responsive-sm">
            <table id="clientTable" class="table-striped">
                <thead>
                    <tr>                       
                        <th>Description</th>
                        <th>Size</th>
                        <th>Grade</th>
                        <th>FSC Claim</th>
                        <th>FSC Certificate</th>
                        <th>Unit</th>
                        <th>Unit Price</th>      
                        <th>Pallets</th>
                        <th>Sheets per Pallet</th>  
                        <th class="center">Quantity</th>                        
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Products.Count(); i++)
                    {
                        <tr id="tablerow0">                           
                            <td>
                                <div class="editor-field">
                                        <select name="DescriptionId[0]" asp-for="Products.ElementAt(i).DescriptionId" class="text-box single-line">
                                        <option value="0">All</option>
                                        @foreach (var description in Model.Products.ElementAt(i).Descriptions)
                                        {
                                                 <option value="@description.Id">@description.Name</option>
                                        }
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div class="editor-field">
                                            <select name="SizeId[0]" asp-for="Products.ElementAt(i).SizeId" class="text-box single-line">
                                        <option value="">All</option>
                                        @foreach (var size in Model.Products.ElementAt(i).Sizes)
                                        {
                                                        <option value="@size">@size</option>
                                        }
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div class="editor-field">
                                        <select name="GradeId[0]" asp-for="Products.ElementAt(i).GradeId" class="text-box single-line">
                                        <option value="">All</option>
                                        @foreach (var grade in Model.Products.ElementAt(i).Grades)
                                        {
                                                        <option value="@grade">@grade</option>
                                        }
                                    </select>
                                </div>
                            </td>                           
                             <td>
                                <div class="editor-field">
                                        <input asp-for="Products.ElementAt(i).FscClaim" class="text-box single-line" name="FscClaim[0]" value="" required="required">
                                </div>
                            </td>
                            <td>
                                <div class="editor-field">
                                        <select name="FscCertificate[0]" asp-for="Products.ElementAt(i).FscSertificate" class="text-box single-line">
                                        <option value="">-</option>
                                        @foreach (var fsc in mycompanyService.MyCompaniesFscList())
                                        {
                                                         <option value="@fsc">@fsc</option>
                                        }
                                        </select>
                                </div>
                            </td>
                                 <td class="col-sm-1">
                                        <div class="editor-field">
                                            <select name="Unit" asp-for="Products.ElementAt(i).Unit" class="text-box single-line">
                                        @foreach (var unit in service.GetUnits())
                                        {
                                                                <option value="@unit">@unit</option>
                                        }
                                            </select>
                                    </div>
                                </td>
                            <td>
                                <div class="editor-field">
                                    <input asp-for="Products.ElementAt(i).Price" class="text-box single-line" name="Price[0]" value="" required="required">
                                </div>
                            </td>
                            <td>
                                <div class="editor-field">
                                    <input asp-for="Products.ElementAt(i).Pallets" class="text-box single-line" name="Pallets[0]" value="" required="required">
                                </div>
                            </td>
                            <td>
                                <div class="editor-field">
                                     <input asp-for="Products.ElementAt(i).SheetsPerPallet" class="text-box single-line" name="SheetsPerPallet[0]" value="" required="required">
                                </div>
                            </td>
                            <td>
                                <div class="editor-field">
                                    <input asp-for="Products.ElementAt(i).Quantity" class="text-box single-line" name="Quantity[0]" value="" required="required">
                                </div>
                            </td>                            
                            <td>
                                <button type="button" class="btn-danger" onclick="removeTr(0);">Delete</button>
                            </td>
                       </tr>
                        <tr>
                         
                        </tr>
                      
                    }                  
                </tbody>                 
            </table>
            <div class="row p-3">
                <button id="addrow" type="button" class="btn btn-outline-success">Add</button>
            </div>
        </div> 
   <input type="submit" class="btn-primary" value="Submit"/>   
    </div>
</form>


@section Scripts {
    <script type="text/javascript">
            $(document).ready(function() {
                //Dropdownlist Selectedchange event
                $("#MyCompanyId").change(function() {                        
                    $("#InvoiceNumber option").remove();
                    var myCompanyId = $(this).val(); 
                    $.ajax({
                        type: 'GET',
                        url: "/Documents/GetInvoiceNumbers", 
                       // dataType: 'json',
                        data: { id: myCompanyId },
                        success: function(selectedInvoiceNumbers) {                           
                            $("#InvoiceNumber").append('<option value="' + "0" + '">' + "Select InvoiceNumber" + '</option>');
                            debugger;
                            for (var i = 0; i < selectedInvoiceNumbers.length; i++) 
                            {
                               $("#InvoiceNumber").append('<option value="' + selectedInvoiceNumbers[i].InvoiceId + '">' + selectedInvoiceNumbers[i].InvoiceNumber + '</option>');
                            }       
                           
                            debugger;
                            //var numbers = '';
                            //$(#InvoiceNumber).empty();
                                //$.each(selectedInvoiceNumbers, function(i, invoice) {
                                            //    numbers += '<option value="' + invoice.InvoiceId + '">' + invoice.InvoiceNumber + '</option>';
                            //    
                                //}); $(#InvoiceNumber).html(invoice);
                       },
                        error: function(ex) {
                            alert('Failed to retrieve invoiceNumber' + ex);
                        }
                    });
                    return false;
                })
            });
             
                    var counter = 1;
                    $(function products () {
                        $('#addrow').click(function () {
                            $('<tr id="tablerow' + counter + '"><td>' +
                                         ' <select class="text-box single-line" name="DescriptionId[' + counter + ']" asp-for="DescriptionId" ><option value="">All</option>@foreach (var desc in service.DescriptionIdAndNameList()){<option value="@desc.Id">@desc.Name</option>}</select>' +
                                '</td>' +
                                '<td>' +
                                    '<select class="text-box single-line" name="SizeId[' + counter + ']" asp-for="SizeId" ><option value="">All</option>@foreach (var size in service.SizeIdAndNameList()){<option value="@size.Id">@size.Name</option>}</select>' +
                                '</td>' +
                                '<td>' +
                                    '<select class="text-box single-line" name="GradeId[' + counter + ']" asp-for="GradeId" ><option value="">All</option>@foreach (var grade in service.GradeIdAndNameList()){<option value="@grade.Id">@grade.Name</option>}</select>' +
                                '</td>' + 
                                '<td>' +
                                '<input class="text-box single-line" name="FscClaim[' + counter + ']" value="" required="required" />' +
                                '</td>' +
                                '<td>' +
                                '<select class="text-box single-line" name ="FscSertificate[' + counter +']" asp-for = "FscSertificate"><option value="">-</option> @foreach (var fsc in mycompanyService.MyCompaniesFscList()){<option value="@fsc">@fsc</option>}</select>' +
                                '</td>'+
                                '<td>' +
                                        '<select class="text-box single-line" name ="Unit[' + counter +']" asp-for = "Unit"><option value="">All</option> @foreach (var unit in service.GetUnits()){<option value="@unit">@unit</option>}</select>' +
                                '</td>'+                              
                                    
                                '<td>' +
                                '<input class="text-box single-line" name="Price[' + counter + ']" value="" required="required" />' +
                                '</td>' +
                                '<td>' +
                                '<input asp-for="Products.ElementAt(i).Pallets" class="text-box single-line" name="Pallets[' + counter + ']" value="" required="required" />' +
                                '</td>' +
                                '<td>' +
                                '<input class="text-box single-line" name="SheetsPerPallet[' + counter + ']" value="" required="required" />' +
                                '</td>' +
                                '<td>' +
                                '<input class="text-box single-line" name="Quantity[' + counter + ']" value="" required="required" />' +
                                '</td>' +
                                '<td>' +
                                 '<button type="button" class="btn btn-primary" onclick="removeTr(' + counter + ');">Delete</button>' +
                                '</td>' +
                                '</tr>').appendTo('#clientTable');
                            counter++;
                            return false;
                        });
                    });

                    function removeTr(index) {
                        if (counter > 1) {
                            $('#tablerow' + index).remove();
                            counter--;
                        }
                        return false;
                    }
       </script>

             <script type="text/javascript" src="~/js/datepicker.js">    
            </script>   
    }

    



    
  


