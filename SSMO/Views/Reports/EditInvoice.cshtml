@model EditInvoiceViewModel
@inject IInvoiceService invoiceService
@using SSMO.Services.Reports
@{
    ViewBag.Title = "Invoice for edit";  
}
<form method="post">
    <div class="row">       
    </div>
    <div class="row col-md-4">
        <label asp-for="Date">Date of the Invoice</label>
        <input asp-for="Date" type="date" class="form-control" id="datepicker" >
    </div>
     <div class="row col-md-4">
        <label asp-for="Incoterms">Delivery Terms</label>
        <input asp-for="Incoterms" type="text" class="form-control">
    </div>
     <div class="row col-md-4">
        <label asp-for="TruckNumber">Truck Number</label>
        <input asp-for="TruckNumber" type="text" class="form-control">
    </div>

     <div class="row col-md-4">
        <label asp-for="NetWeight">Net Weight</label>
        <input asp-for="NetWeight" type="number" class="form-control">
    </div>
     <div class="row col-md-4">
        <label asp-for="GrossWeight">Gross Weight</label>
        <input asp-for="GrossWeight" type="number" class="form-control">
    </div>
   <div class="row col-md-4">
        <label asp-for="DeliveryCost">Delivery Cost</label>
        <input asp-for="DeliveryCost" type="number" min="0" step="0.00001" class="form-control">
    </div>
     <div class="form-group row col-md-4">
        <label asp-for="ChosenBanks">Choose Banks</label>
        <select asp-for="ChosenBanks" class="form-control" multiple>
            @foreach (var item in Model.CompanyBankDetails)
            {
                       <option value="@item.Id">@item.CurrencyName:@item.BankName - @item.Iban</option>
            }  
        </select>
   <span asp-validation-for="ChosenBanks" class="small text-danger"></span>
    </div>
    <div class="row col-md-4">
        <label asp-for="CurrencyExchangeRate">Currency Exchange Rate to BGN</label>
        <input asp-for="CurrencyExchangeRate" type="number"  min="0.00000" step="0.00001" class="form-control" >
    </div>

    <div class="row col-md-4">
        <label asp-for="Comment">Comment</label>
        <input asp-for="Comment" type="text" class="form-control">
    </div>
    <div class="form-group row col-md-4">
        <label >Choose Fiscal Agent</label>
        <select asp-for="FiscalAgentId" class="form-control">
            <option value="@Model.FiscalAgentName" selected>@Model.FiscalAgentName</option>
            @foreach (var item in Model.CompanyBankDetails)
            {
               <option value="@item.Id">@item.CurrencyName:@item.BankName - @item.Iban</option>
            }   

        </select>
    </div>
     <div class="form-group row col-md-4">
        <label >Fsc Text</label>
        <select asp-for="FscTextEng" class="form-control">
            <option value="-" selected>@Model.FscText</option>
            @foreach (var item in Model.FscTexts)
            {
                 <option value="@item.Id">@item.FscTextEng</option>
            }   

        </select>
    </div>
            <p><b>Edit Products</b></p>
      <table>
        <thead>
            <tr>                       
                <th>Description</th>
                <th>Size</th>
                <th>Grade</th>
                <th>FSC Claim</th>
                <th>FSC Certificate</th>
                <th>Unit</th>
                <th>Quantity </th>  
                <th>Unit Price</th>  
                <th>Pallets</th>
                <th>Sheets/Pallet</th>
            </tr>
         </thead>
        <tbody>
            @for (var i = 0; i < Model.Products.Count; i++)
            {
                            <tr>
                              <input type="hidden" asp-for="@Model.Products[i].Id"/>
                              <input type="hidden" asp-for="@Model.Products[i].ProductId"/>
                                    <td >
                                    <div class="editor-field">
                                          <select asp-for="@Model.Products[i].DescriptionId" value="@Model.Products[i].DescriptionId">
                                        <option value="">All</option>
                                @foreach (var description in Model.Products[i].Descriptions)
                                {
                                                      <option value="@description.Id">@description.Name</option>
                                }
                                        </select>                                        
                                    </div>
                                </td>
                                      <td >
                                        <div class="editor-field" >
                                                     <select asp-for="@Model.Products[i].GradeId" value="@Model.Products[i].GradeId">
                                         <option value="">All</option>
                                @foreach (var grade in Model.Products[i].Grades)
                                {
                                                      <option value="@grade.Id">@grade.Name</option>
                                }
                                        </select>  
                                            </div>
                                        </td>
                                      <td >
                                    <div class="editor-field">
                                                      <select asp-for="@Model.Products[i].SizeId" value="@Model.Products[i].SizeId">
                                          <option value="">All</option>
                                @foreach (var size in Model.Products[i].Sizes)
                                {
                                                      <option value="@size.Id">@size.Name</option>
                                }
                                        </select>  
                                    </div>
                                </td>
                                        <td >
                                    <div class="editor-field">
                                                <input asp-for="@Model.Products[i].FscClaim" value="@Model.Products[i].FscClaim" type="text" class="form-control"/>
                                    </div>
                                </td>
                                      <td >
                                    <div class="editor-field">
                                               <input asp-for="@Model.Products[i].FscSertificate" value="@Model.Products[i].FscSertificate" type="text" class="form-control"/>
                                    </div>
                                </td>
                                    <td >
                                    <div class="editor-field">
                                        <input asp-for="@Model.Products[i].Unit" value="@Model.Products[i].Unit" type="text" class="form-control"/>
                                    </div>
                                </td>
                                    <td>
                                    <div class="editor-field" scope="col">
                                       <input asp-for="@Model.Products[i].InvoicedQuantity" value="@Model.Products[i].InvoicedQuantity" type="number" class="form-control"/>
                                </div>
                            </td>
                                     <td>
                                <div class="editor-field">
                                           <input asp-for="@Model.Products[i].SellPrice" value="@Model.Products[i].SellPrice" type="number" class="form-control"/>
                                        <span asp-validation-for="@Model.Products[i].SellPrice" class="small text-danger"></span>
                                </div>
                            </td>
                                    <td >
                                <div class="editor-field">
                                                <input asp-for="@Model.Products[i].Pallets" value="@Model.Products[i].Pallets" type="number" class="form-control"/>
                                        <span asp-validation-for="@Model.Products[i].Pallets" class="small text-danger"></span>
                                </div>
                            </td>
                                    <td >
                                <div class="editor-field">
                                   <input asp-for="@Model.Products[i].SheetsPerPallet" value="@Model.Products[i].SheetsPerPallet" type="number" class="form-control"/>
                                  <span asp-validation-for="@Model.Products[i].SheetsPerPallet" class="small text-danger"></span>
                                </div>
                            </td>
                          </tr>                    
            }
          </tbody>
 </table>
 <div class="editor-field">
       <select name="CustomerId" id="CustomerId" asp-for="CustomerId" >
           <option value="">All</option>
            @foreach (var customer in invoiceService.CustomersForeEditInvoice())
            {
                <option value="@customer.Id">@customer.Name</option>
            }
       </select>
   </div>
   <div class="row col-md-4 ">           
                 <label asp-for="SelectedCustomerOrders" class="control-label"> Select Customer Order</label>
                 <select multiple asp-for="SelectedCustomerOrders" class="form-control" id="CustomerOrderNumber" name="SelectedCustomerOrders" asp-items="@(new SelectList(string.Empty,"CustomerOrderId", "CustomerOrderNumber"))"></select>               
     </div>
    @*<div class="form-group col-md-4">
            <label>Choose/Add New CustomerOrder</label>
            <select multiple asp-for="CustomerOrdersId" class="form-control">
            <option value="">-</option>
            @foreach (var order in Model.CustomerOrders)
            {
               <option value="@order.Id">@order.OrderConfirmationNumber</option>
                    <br />
            }
            </select>
     </div>*@
  <div class="row">
       <td class="col"> <input type="submit" name="Command" value="Save" class="btn btn-primary mt-3" /></td> 
       <td> </td>
       <td class="col"><input type="submit" name="Command" value="Add New Products" class="btn btn-primary mt-3" /></td> 
    </div>
</form>

    
 <script type="text/javascript">
    $(function () {
        $("#datepicker").datepicker();
    });
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
        <script type="text/javascript">
                    $(document).ready
                    (
                            function() 
                            {
                            //Dropdownlist Selectedchange event
                            $("#CustomerId").change(function() {                        
                                $("#CustomerOrderNumber option").remove();
                                var customerId = $(this).val(); 
                                $.ajax({
                                    type: 'GET',
                                    url: "/Documents/GetCustomerOrders", 
                                    dataType: 'json',
                                    data: { id: customerId },
                                    success: function(selectedCustomerOrders) {                           
                                        $("#CustomerOrderNumber").append('<option value="' + "0" + '">' + "Select CustomerOrderNumber" + '</option>');
                                        debugger;
                                        for (var i = 0; i < selectedCustomerOrders.length; i++) 
                                        {
                                           $("#CustomerOrderNumber").append('<option value="' + selectedCustomerOrders[i].CustomerOrderId + '">' + selectedCustomerOrders[i].CustomerOrderNumber + '</option>');
                                        }     

                                        debugger;                          
                                   },
                                    error: function(ex) {
                                        alert('Failed to retrieve selectedCustomerOrders' + ex);
                                    }
                                });
                                return false;
                            })
                            }

                        );

             </script>
}